<h2 class="content-block">Анализы</h2>

<dx-data-grid class="dx-card wide-card"
              id="suDataGrid"
              [dataSource]="dataSource"
              [showBorders]="false"
              [columnAutoWidth]="true"
              [columnHidingEnabled]="true"
              (onToolbarPreparing)="onToolbarPreparing($event)"
              (onOptionChanged)="onGridOptionsChanged($event)"
              [masterDetail]="{ enabled: true, template: 'detail' }">

  <dxo-remote-operations
    [paging]="false"
    [sorting]="false"
    [filtering]="false">
  </dxo-remote-operations>

  <dxo-search-panel
    [visible]="false">
  </dxo-search-panel>

  <!--  TODO: hide/show on button -->
  <dxo-filter-row [visible]="false"></dxo-filter-row>

  <dxo-paging [pageSize]="5"></dxo-paging>
  <dxo-pager [showPageSizeSelector]="true"
             [showInfo]="true"
             [allowedPageSizes]="[5, 50, 100]"></dxo-pager>

  <dxo-editing
    [allowAdding]="false"
    [allowUpdating]="false"
    [allowDeleting]="false">
  </dxo-editing>

  <dxi-column
    dataField="name"
    caption="Название">
  </dxi-column>

  <dxi-column
    dataField="templateName"
    caption="Тип">
  </dxi-column>

  <dxi-column
    dataField="analysisDate"
    caption="Дата сдачи"
    dataType="date"
    format="dd.MM.yyyy">
  </dxi-column>

  <dxi-column
    dataField="commentary"
    caption="Комментарий">
  </dxi-column>

  <!--TODO: make it look better-->
  <dxo-master-detail [enabled]="true" analysis="detail">
  </dxo-master-detail>
  [allowEditing]="true"
  <div *dxTemplate="let analysis of 'detail'">
    <div class="master-detail-images">
      <div *ngFor="let fileName of analysis.data.images; let i = index">
        <img
          [src]="downloadUrl + '/share/analysis/' + analysis.data.id + '/image/' + fileName + '?token=' | shared:token | async"/>
      </div>
    </div>
    <div class="master-detail-caption">{{
        'Параметры анализа'
      }}
    </div>
    <!--TODO: change datasource-->
    <dx-data-grid
      [dataSource]="analysis.data.parameters"
      [showBorders]="false"
      [columnAutoWidth]="true"
      [columnHidingEnabled]="true">
      <dxi-column dataField="name" caption="Название" dataType="string"></dxi-column>
      <dxi-column dataField="value" caption="Значение" dataType="string"></dxi-column>
      <dxi-column dataField="unit" caption="Единица измерения" dataType="string"></dxi-column>
      <dxi-column dataField="state" caption="Состояние">
        <dxo-lookup
          [dataSource]="analysisParameterStateMapping"
          valueExpr="id"
          displayExpr="value">
        </dxo-lookup>
      </dxi-column>
    </dx-data-grid>
  </div>

  <!--TODO: do I need it?-->
  <!--  <dxi-column-->
  <!--    [allowEditing]="false"-->
  <!--    dataField="lastModifiedAt"-->
  <!--    caption="Обновлен"-->
  <!--    dataType="date"-->
  <!--    format="dd.MM.yyyy hh:mm"-->
  <!--    [formItem]="{visible: false}"-->
  <!--    [allowSearch]="false">-->
  <!--  </dxi-column>-->

</dx-data-grid>
